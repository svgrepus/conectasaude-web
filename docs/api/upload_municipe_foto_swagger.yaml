openapi: 3.0.3
info:
  title: ConectaSa√∫de - API Completa do Sistema de Secretaria de Sa√∫de
  description: |
    API completa para gest√£o de Secretaria Municipal de Sa√∫de desenvolvida com Supabase.
    
    ## Funcionalidades Principais
    
    ### üè• Gest√£o de Medicamentos
    - Cadastro e gerenciamento de medicamentos
    - Controle de estoque por unidade
    - Movimenta√ß√µes (entrada, sa√≠da, transfer√™ncia)
    - Alertas de vencimento e estoque m√≠nimo
    - Status e obsolesc√™ncia
    
    ### üöó Gest√£o de Ve√≠culos e Motoristas
    - Cadastro de ve√≠culos da frota municipal
    - Gest√£o de motoristas com escalas de trabalho
    - Controle de acesso ao sistema
    
    ### üë• Gest√£o de Mun√≠cipes
    - Cadastro completo de mun√≠cipes
    - Dados de sa√∫de e cart√£o SUS
    - Upload de fotos
    - Endere√ßos e informa√ß√µes de contato
    
    ### üìä Relat√≥rios e Auditoria
    - Relat√≥rios de estoque por per√≠odo/unidade/medicamento
    - Logs de auditoria e versionamento
    - Controle de acesso por perfil (RLS)
    
    ## Autentica√ß√£o
    
    O sistema utiliza autentica√ß√£o JWT do Supabase com tr√™s perfis principais:
    - **admin**: Acesso total ao sistema
    - **operador**: CRUD b√°sico e movimenta√ß√£o de estoque
    - **consulta**: Apenas leitura
    
    ## Padr√µes
    
    - **IDs**: UUID com gen_random_uuid()
    - **Timestamps**: timestamptz (UTC)
    - **Soft Delete**: campo deleted_at
    - **Versionamento**: tabelas _history
    - **Nomenclatura**: snake_case
    
  version: 2.0.0
  contact:
    name: ConectaSa√∫de Development Team
    email: dev@conectasaude.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://neqkqjpynrinlsodfrkf.supabase.co/rest/v1
    description: Servidor de produ√ß√£o Supabase (RECOMENDADO)
  - url: http://localhost:8000
    description: Servidor de desenvolvimento local (Edge Functions)
  - url: http://localhost:3000
    description: Servidor PostgREST local

paths:
  # ===========================================
  # UPLOAD DE FOTO DE MUN√çCIPE (Edge Function)
  # ===========================================
  /upload_municipe_foto:
    options:
      tags: ["Upload", "Mun√≠cipes"]
      summary: CORS Preflight para upload de foto
      description: Requisi√ß√£o OPTIONS para verifica√ß√£o de CORS
      responses:
        '200':
          description: CORS preflight bem-sucedido
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
                example: "*"
          content:
            text/plain:
              schema:
                type: string
                example: "ok"

    post:
      tags: ["Upload", "Mun√≠cipes"]
      summary: Upload de Foto do Mun√≠cipe
      description: |
        Faz o upload de uma foto para um mun√≠cipe espec√≠fico.
        
        ### Processo:
        1. Valida a autentica√ß√£o do usu√°rio
        2. Verifica se o mun√≠cipe existe e est√° ativo
        3. Valida o tipo e tamanho do arquivo (m√°x. 5MB)
        4. Decodifica o arquivo base64
        5. Faz upload para o Supabase Storage
        6. Gera URL assinada com validade de 1 ano
        7. Atualiza o registro do mun√≠cipe com a URL da foto
        
      security:
        - apiKeyAuth: []
        - bearerAuth: []
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UploadFotoRequest'
            examples:
              upload_jpg:
                summary: Upload de foto JPG
                value:
                  municipe_id: 123
                  file_data: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD..."
                  file_name: "foto_joao.jpg"
                  content_type: "image/jpeg"

      responses:
        '200':
          description: Upload realizado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadFotoResponse'
        '400':
          description: Erro de valida√ß√£o
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: N√£o autorizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ===========================================
  # MEDICAMENTOS
  # ===========================================
  /rest/v1/medicamentos:
    get:
      tags: ["Medicamentos"]
      summary: Listar medicamentos
      description: Lista medicamentos ativos (soft delete)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SelectParam'
        - $ref: '#/components/parameters/FilterStatus'
        - $ref: '#/components/parameters/OrderParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Lista de medicamentos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Medicamento'

    post:
      tags: ["Medicamentos"]
      summary: Criar medicamento
      description: Cadastra um novo medicamento
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MedicamentoCreate'
      responses:
        '201':
          description: Medicamento criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Medicamento'

  /rest/v1/medicamentos_active:
    get:
      tags: ["Medicamentos"]
      summary: Listar medicamentos ativos
      description: View que filtra apenas medicamentos n√£o exclu√≠dos
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SelectParam'
        - $ref: '#/components/parameters/FilterStatus'
      responses:
        '200':
          description: Lista de medicamentos ativos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Medicamento'

  # ===========================================
  # MOVIMENTA√á√ïES DE ESTOQUE (RPCs)
  # ===========================================
  /rest/v1/rpc/rpc_estoque_entrada:
    post:
      tags: ["Estoque", "RPCs"]
      summary: Entrada de estoque
      description: |
        Processa entrada de medicamentos no estoque com valida√ß√µes e auditoria.
        
        ### Valida√ß√µes:
        - Quantidade deve ser maior que zero
        - Medicamento deve existir e estar ativo
        - Unidade de destino deve existir
        - Usu√°rio deve ter perfil 'admin' ou 'operador'
        
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EstoqueEntradaRequest'
      responses:
        '200':
          description: Entrada processada com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovimentacaoResponse'

  /rest/v1/rpc/rpc_estoque_saida:
    post:
      tags: ["Estoque", "RPCs"]
      summary: Sa√≠da de estoque
      description: |
        Processa sa√≠da de medicamentos do estoque com valida√ß√£o de saldo.
        
        ### Valida√ß√µes:
        - Quantidade deve ser maior que zero
        - Saldo suficiente na unidade de origem
        - Destino obrigat√≥rio
        
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EstoqueSaidaRequest'
      responses:
        '200':
          description: Sa√≠da processada com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovimentacaoResponse'

  /rest/v1/rpc/rpc_estoque_transferencia:
    post:
      tags: ["Estoque", "RPCs"]
      summary: Transfer√™ncia entre unidades
      description: |
        Processa transfer√™ncia entre unidades com opera√ß√£o at√¥mica.
        
        ### Valida√ß√µes:
        - Unidades origem e destino diferentes
        - Saldo suficiente na origem
        - Opera√ß√£o at√¥mica (d√©bito + cr√©dito)
        
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EstoqueTransferenciaRequest'
      responses:
        '200':
          description: Transfer√™ncia processada com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovimentacaoResponse'

  /rest/v1/rpc/rpc_consultar_saldo_estoque:
    post:
      tags: ["Estoque", "RPCs", "Consultas"]
      summary: Consultar saldo de estoque
      description: |
        Consulta saldos de estoque com alertas de m√≠nimo.
        
        ### N√≠veis de Alerta:
        - **CR√çTICO**: Quantidade <= m√≠nimo
        - **ATEN√á√ÉO**: Quantidade <= m√≠nimo * 1.5
        - **OK**: Quantidade > m√≠nimo * 1.5
        
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConsultaSaldoRequest'
      responses:
        '200':
          description: Saldos de estoque
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SaldoEstoque'

  # ===========================================
  # MOTORISTAS
  # ===========================================
  /rest/v1/motoristas:
    get:
      tags: ["Motoristas"]
      summary: Listar motoristas
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SelectParam'
        - $ref: '#/components/parameters/OrderParam'
      responses:
        '200':
          description: Lista de motoristas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Motorista'

    post:
      tags: ["Motoristas"]
      summary: Criar motorista
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MotoristaCreate'
      responses:
        '201':
          description: Motorista criado

  # ===========================================
  # VE√çCULOS
  # ===========================================
  /rest/v1/veiculos:
    get:
      tags: ["Ve√≠culos"]
      summary: Listar ve√≠culos
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de ve√≠culos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Veiculo'

    post:
      tags: ["Ve√≠culos"]
      summary: Criar ve√≠culo
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VeiculoCreate'
      responses:
        '201':
          description: Ve√≠culo criado

  # ===========================================
  # MUN√çCIPES
  # ===========================================
  /rest/v1/municipes:
    get:
      tags: ["Mun√≠cipes"]
      summary: Listar mun√≠cipes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de mun√≠cipes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Municipe'

    post:
      tags: ["Mun√≠cipes"]
      summary: Criar mun√≠cipe
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MunicipeCreate'
      responses:
        '201':
          description: Mun√≠cipe criado

  # ===========================================
  # RELAT√ìRIOS (Views)
  # ===========================================
  /rest/v1/vw_alerta_minimo_atingido:
    get:
      tags: ["Relat√≥rios", "Estoque"]
      summary: Medicamentos com estoque m√≠nimo atingido
      description: Lista medicamentos com quantidade menor ou igual ao m√≠nimo definido
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Medicamentos em alerta
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AlertaMinimo'

  /rest/v1/vw_medicamentos_vencendo:
    get:
      tags: ["Relat√≥rios", "Medicamentos"]
      summary: Medicamentos pr√≥ximos do vencimento
      description: Lista medicamentos que vencem nos pr√≥ximos dias (padr√£o 60 dias)
      security:
        - bearerAuth: []
      parameters:
        - name: dias
          in: query
          description: N√∫mero de dias para alerta de vencimento
          schema:
            type: integer
            default: 60
      responses:
        '200':
          description: Medicamentos vencendo
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MedicamentoVencimento'

  # ===========================================
  # EXPORT DE RELAT√ìRIOS (Edge Function)
  # ===========================================
  /relatorios_export:
    post:
      tags: ["Relat√≥rios", "Export"]
      summary: Exportar relat√≥rios em CSV
      description: |
        Gera relat√≥rios em formato CSV para download.
        
        ### Tipos de Relat√≥rio:
        - **estoque_por_periodo**: Movimenta√ß√µes por per√≠odo
        - **estoque_por_unidade**: Saldos por unidade
        - **estoque_por_medicamento**: Hist√≥rico por medicamento
        - **alerta_minimo**: Medicamentos em alerta
        - **vencimento**: Medicamentos vencendo
        
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExportRelatorioRequest'
      responses:
        '200':
          description: Arquivo CSV
          content:
            text/csv:
              schema:
                type: string
              examples:
                estoque_csv:
                  summary: Exemplo de CSV de estoque
                  value: |
                    medicamento,unidade,quantidade,minimo_alerta,status
                    Paracetamol 500mg,Almoxarifado Central,1500,100,OK
                    Dipirona 500mg,UBS Centro,50,100,CR√çTICO

components:
  securitySchemes:
    apiKeyAuth:
      type: apiKey
      in: header
      name: apikey
      description: |
        **Chave API do Supabase** (Recomendado para PostgREST)
        
        **Como obter:**
        1. Acesse: https://supabase.com/dashboard/project/neqkqjpynrinlsodfrkf/settings/api
        2. Copie a chave "anon public" (para testes)
        3. Cole no campo "Value" abaixo
        
        **Exemplo:** eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        **Token JWT** (Alternativa - mesmo valor da chave API)
        
        **Perfis de Acesso:**
        - `admin`: Acesso total ao sistema
        - `operador`: CRUD b√°sico + movimenta√ß√£o de estoque
        - `consulta`: Apenas leitura
        
        **Como usar:** Cole sua chave Supabase (sem "Bearer ")

  parameters:
    SelectParam:
      name: select
      in: query
      description: Colunas a serem retornadas (padr√£o PostgREST)
      schema:
        type: string
        example: "id,nome,status"

    FilterStatus:
      name: status
      in: query
      description: Filtrar por status
      schema:
        type: string
        enum: ["ATIVO", "INATIVO"]

    OrderParam:
      name: order
      in: query
      description: Ordena√ß√£o (padr√£o PostgREST)
      schema:
        type: string
        example: "created_at.desc"

    LimitParam:
      name: limit
      in: query
      description: Limite de registros
      schema:
        type: integer
        minimum: 1
        maximum: 1000
        default: 20

  schemas:
    # ===========================================
    # UPLOAD DE FOTO
    # ===========================================
    UploadFotoRequest:
      type: object
      required:
        - municipe_id
        - file_data
        - file_name
        - content_type
      properties:
        municipe_id:
          type: integer
          description: ID √∫nico do mun√≠cipe
          example: 123
        file_data:
          type: string
          format: base64
          description: Dados do arquivo em formato base64
          example: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD..."
        file_name:
          type: string
          description: Nome do arquivo incluindo extens√£o
          example: "foto_municipe.jpg"
        content_type:
          type: string
          enum: ["image/jpeg", "image/jpg", "image/png"]
          description: Tipo MIME do arquivo
          example: "image/jpeg"

    UploadFotoResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Foto do mun√≠cipe carregada com sucesso."
        foto_url:
          type: string
          format: uri
          description: URL assinada da foto
        signed_url:
          type: string
          format: uri
          description: Mesmo que foto_url
        file_path:
          type: string
          description: Caminho do arquivo no storage

    # ===========================================
    # MEDICAMENTOS
    # ===========================================
    Medicamento:
      type: object
      properties:
        id:
          type: string
          format: uuid
        dcb_dci:
          type: string
          description: Denomina√ß√£o Comum Brasileira / Denomina√ß√£o Comum Internacional
          example: "Paracetamol"
        forca_concentracao:
          type: string
          description: For√ßa/concentra√ß√£o do medicamento
          pattern: '^\d+([\.,]\d+)?\s?(mg|g|mcg|ml|IU|%)(\/(mg|g|mcg|ml|IU|%))?$'
          example: "500mg"
        unidade_controle_id:
          type: string
          format: uuid
        codigo_interno:
          type: string
          description: C√≥digo interno gerado automaticamente
          example: "MED000001"
        status:
          type: string
          enum: ["ATIVO", "INATIVO"]
          default: "ATIVO"
        obsoleto:
          type: boolean
          default: false
        validade:
          type: string
          format: date
          description: Data de validade (deve ser >= data atual)
        custo:
          type: number
          format: decimal
          minimum: 0
        valor_repasse:
          type: number
          format: decimal
          minimum: 0
        local_armazenamento:
          type: string
        observacoes:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    MedicamentoCreate:
      type: object
      required:
        - dcb_dci
        - unidade_controle_id
        - validade
      properties:
        dcb_dci:
          type: string
        forca_concentracao:
          type: string
        unidade_controle_id:
          type: string
          format: uuid
        validade:
          type: string
          format: date
        custo:
          type: number
          format: decimal
        valor_repasse:
          type: number
          format: decimal
        local_armazenamento:
          type: string
        observacoes:
          type: string

    # ===========================================
    # MOVIMENTA√á√ïES DE ESTOQUE
    # ===========================================
    EstoqueEntradaRequest:
      type: object
      required:
        - p_medicamento_id
        - p_unidade_destino_id
        - p_quantidade
      properties:
        p_medicamento_id:
          type: string
          format: uuid
        p_unidade_destino_id:
          type: string
          format: uuid
        p_quantidade:
          type: number
          format: decimal
          minimum: 0.001
        p_lote:
          type: string
        p_data_entrada:
          type: string
          format: date
        p_motivo:
          type: string
          default: "Entrada de estoque"

    EstoqueSaidaRequest:
      type: object
      required:
        - p_medicamento_id
        - p_unidade_origem_id
        - p_quantidade
        - p_destino
      properties:
        p_medicamento_id:
          type: string
          format: uuid
        p_unidade_origem_id:
          type: string
          format: uuid
        p_quantidade:
          type: number
          format: decimal
          minimum: 0.001
        p_destino:
          type: string
          description: Destino da sa√≠da
        p_motivo:
          type: string
          default: "Sa√≠da de estoque"

    EstoqueTransferenciaRequest:
      type: object
      required:
        - p_medicamento_id
        - p_unidade_origem_id
        - p_unidade_destino_id
        - p_quantidade
      properties:
        p_medicamento_id:
          type: string
          format: uuid
        p_unidade_origem_id:
          type: string
          format: uuid
        p_unidade_destino_id:
          type: string
          format: uuid
        p_quantidade:
          type: number
          format: decimal
          minimum: 0.001
        p_motivo:
          type: string
          default: "Transfer√™ncia entre unidades"

    MovimentacaoResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
        movimento_id:
          type: string
          format: uuid
        medicamento:
          type: string
        quantidade:
          type: number
          format: decimal
        executed_at:
          type: string
          format: date-time

    ConsultaSaldoRequest:
      type: object
      properties:
        p_medicamento_id:
          type: string
          format: uuid
        p_unidade_id:
          type: string
          format: uuid

    SaldoEstoque:
      type: object
      properties:
        medicamento_id:
          type: string
          format: uuid
        medicamento_nome:
          type: string
        unidade_id:
          type: string
          format: uuid
        unidade_nome:
          type: string
        quantidade:
          type: number
          format: decimal
        minimo_alerta:
          type: number
          format: decimal
        status_alerta:
          type: string
          enum: ["OK", "ATEN√á√ÉO", "CR√çTICO"]
        unidade_controle:
          type: string

    # ===========================================
    # MOTORISTAS
    # ===========================================
    Motorista:
      type: object
      properties:
        id:
          type: string
          format: uuid
        nome:
          type: string
        cpf:
          type: string
          pattern: '^\d{3}\.\d{3}\.\d{3}-\d{2}$'
        rg:
          type: string
        data_nascimento:
          type: string
          format: date
        estado_civil:
          type: string
          enum: ["SOLTEIRO", "CASADO", "DIVORCIADO", "VIUVO", "UNIAO_ESTAVEL"]
        sexo:
          type: string
          enum: ["M", "F"]
        email:
          type: string
          format: email
        telefone:
          type: string
        possui_acesso:
          type: boolean
        perfil_acesso_id:
          type: string
          format: uuid
        cargo_id:
          type: string
          format: uuid
        foto_url:
          type: string
        observacoes:
          type: string

    MotoristaCreate:
      type: object
      required:
        - nome
        - cpf
        - rg
        - data_nascimento
        - sexo
        - telefone
        - cargo_id
      properties:
        nome:
          type: string
        cpf:
          type: string
        rg:
          type: string
        data_nascimento:
          type: string
          format: date
        estado_civil:
          type: string
          enum: ["SOLTEIRO", "CASADO", "DIVORCIADO", "VIUVO", "UNIAO_ESTAVEL"]
        sexo:
          type: string
          enum: ["M", "F"]
        email:
          type: string
          format: email
        telefone:
          type: string
        possui_acesso:
          type: boolean
          default: false
        perfil_acesso_id:
          type: string
          format: uuid
        cargo_id:
          type: string
          format: uuid
        observacoes:
          type: string

    # ===========================================
    # VE√çCULOS
    # ===========================================
    Veiculo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        marca:
          type: string
        modelo:
          type: string
        ano_fabricacao:
          type: integer
          minimum: 1980
        placa:
          type: string
          pattern: '^[A-Z]{3}-[0-9]{4}$|^[A-Z]{3}[0-9][A-Z][0-9]{2}$'
          description: "Formato antigo (ABC-1234) ou Mercosul (ABC1D23)"
        capacidade_passageiros:
          type: integer
          minimum: 1
        combustivel:
          type: string
          enum: ["GASOLINA", "ALCOOL", "DIESEL", "FLEX", "ELETRICO"]
        autonomia_km:
          type: number
          format: decimal
        situacao:
          type: string
          enum: ["ATIVO", "INATIVO", "MANUTENCAO"]
          default: "ATIVO"
        tipo_id:
          type: string
          format: uuid
        cor:
          type: string
        renavam:
          type: string
        chassi:
          type: string
        observacoes:
          type: string

    VeiculoCreate:
      type: object
      required:
        - marca
        - modelo
        - ano_fabricacao
        - placa
        - capacidade_passageiros
        - combustivel
        - tipo_id
      properties:
        marca:
          type: string
        modelo:
          type: string
        ano_fabricacao:
          type: integer
        placa:
          type: string
        capacidade_passageiros:
          type: integer
        combustivel:
          type: string
          enum: ["GASOLINA", "ALCOOL", "DIESEL", "FLEX", "ELETRICO"]
        autonomia_km:
          type: number
        tipo_id:
          type: string
          format: uuid
        cor:
          type: string
        renavam:
          type: string
        chassi:
          type: string

    # ===========================================
    # MUN√çCIPES
    # ===========================================
    Municipe:
      type: object
      properties:
        id:
          type: string
          format: uuid
        nome_completo:
          type: string
        cpf:
          type: string
          pattern: '^\d{3}\.\d{3}\.\d{3}-\d{2}$'
        rg:
          type: string
        data_nascimento:
          type: string
          format: date
        estado_civil:
          type: string
          enum: ["SOLTEIRO", "CASADO", "DIVORCIADO", "VIUVO", "UNIAO_ESTAVEL"]
        sexo:
          type: string
          enum: ["M", "F"]
        email:
          type: string
          format: email
        telefone:
          type: string
        nome_mae:
          type: string
        foto_url:
          type: string
        observacoes:
          type: string

    MunicipeCreate:
      type: object
      required:
        - nome_completo
        - cpf
        - rg
        - data_nascimento
        - sexo
      properties:
        nome_completo:
          type: string
        cpf:
          type: string
        rg:
          type: string
        data_nascimento:
          type: string
          format: date
        estado_civil:
          type: string
        sexo:
          type: string
          enum: ["M", "F"]
        email:
          type: string
        telefone:
          type: string
        nome_mae:
          type: string

    # ===========================================
    # RELAT√ìRIOS
    # ===========================================
    AlertaMinimo:
      type: object
      properties:
        medicamento_id:
          type: string
          format: uuid
        medicamento_nome:
          type: string
        unidade_nome:
          type: string
        quantidade_atual:
          type: number
          format: decimal
        minimo_alerta:
          type: number
          format: decimal
        deficit:
          type: number
          format: decimal
        dias_sem_estoque:
          type: integer

    MedicamentoVencimento:
      type: object
      properties:
        medicamento_id:
          type: string
          format: uuid
        medicamento_nome:
          type: string
        validade:
          type: string
          format: date
        dias_para_vencer:
          type: integer
        unidades_com_estoque:
          type: array
          items:
            type: object
            properties:
              unidade_nome:
                type: string
              quantidade:
                type: number

    ExportRelatorioRequest:
      type: object
      required:
        - tipo_relatorio
      properties:
        tipo_relatorio:
          type: string
          enum: 
            - "estoque_por_periodo"
            - "estoque_por_unidade"
            - "estoque_por_medicamento"
            - "alerta_minimo"
            - "vencimento"
        filtros:
          type: object
          properties:
            data_inicio:
              type: string
              format: date
            data_fim:
              type: string
              format: date
            unidade_id:
              type: string
              format: uuid
            medicamento_id:
              type: string
              format: uuid
            dias_vencimento:
              type: integer
              default: 60

    # ===========================================
    # RESPONSES PADR√ÉO
    # ===========================================
    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: Mensagem de erro em portugu√™s
        details:
          type: object
          description: Detalhes adicionais do erro

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
        data:
          type: object

tags:
  - name: Upload
    description: Opera√ß√µes de upload de arquivos
  - name: Medicamentos
    description: Gest√£o de medicamentos e cadastro
  - name: Estoque
    description: Controle de estoque e movimenta√ß√µes
  - name: RPCs
    description: Procedimentos remotos para opera√ß√µes complexas
  - name: Motoristas
    description: Gest√£o de motoristas da frota
  - name: Ve√≠culos
    description: Gest√£o de ve√≠culos da frota municipal
  - name: Mun√≠cipes
    description: Cadastro e gest√£o de mun√≠cipes
  - name: Relat√≥rios
    description: Relat√≥rios e consultas do sistema
  - name: Export
    description: Exporta√ß√£o de dados em CSV
  - name: Consultas
    description: Consultas e views do sistema
